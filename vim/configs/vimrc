call plug#begin('~/.vim/plugged')

" On-demand loading
Plug 'scrooloose/nerdtree', { 'on':  'NERDTreeToggle' }

" Using a tagged release; wildcard allowed (requires git 1.9.2 or above)
Plug 'fatih/vim-go', { 'do': ':GoInstallBinaries'}

" auto complete plug; deoplete for vim8.0 need `has('python3')` for async
" `pip3 install neovim` is required or `pacin python-neovim` in archlinux
Plug 'Shougo/deoplete.nvim'
Plug 'roxma/nvim-yarp'
Plug 'roxma/vim-hug-neovim-rpc'

" complete for golang
Plug 'zchee/deoplete-go', { 'do': 'make'}

" complete for java
Plug 'artur-shaik/vim-javacomplete2'

" Track the engine.
" Plugin 'SirVer/ultisnips'

" Snippets are separated from the engine. Add this if you want them:
Plug 'SirVer/ultisnips'
Plug 'honza/vim-snippets'

" Tagbar: a class outline viewer for Vim
Plug 'majutsushi/tagbar'

" zoom a pane by 'ctrl-w o'
Plug 'vim-scripts/ZoomWin'

" mini buffer expl
"Plug 'fholgado/minibufexpl.vim'

" unload file buffer without destory window layout
Plug 'qpkorr/vim-bufkill'

" vim airline
Plug 'vim-airline/vim-airline'
Plug 'vim-airline/vim-airline-themes'
Plug 'airblade/vim-gitgutter'
Plug 'tpope/vim-fugitive'
"Plug 'bling/vim-bufferline'

" Initialize plugin system
call plug#end()

" Use deoplete.
let g:deoplete#enable_at_startup = 1
let g:deoplete#enable_yarp = 1
let g:deoplete#enable_camel_case = 1
let g:deoplete#enable_refresh_always = 1
inoremap <silent><expr><TAB> pumvisible() ? "\<C-n>" : "\<TAB>"

" Trigger configuration. Do not use <tab> if you use https://github.com/Valloric/YouCompleteMe.
let g:UltiSnipsExpandTrigger="<tab>"
let g:UltiSnipsJumpForwardTrigger="<tab>"
let g:UltiSnipsJumpBackwardTrigger="<s-tab>"

" airline theme
let g:airline_theme="bubblegum"
let g:airline_powerline_fonts = 1
let g:airline_detect_modified=1
"let g:airline_skip_empty_sections = 1
let g:airline_extensions = ['branch', 'tabline']

let g:gitgutter_sign_added = 'A'
let g:gitgutter_sign_modified = 'M'
let g:gitgutter_sign_removed = 'D'
let g:gitgutter_sign_removed_first_line = 'DF'
let g:gitgutter_sign_modified_removed = 'MD'

" close vim if the only window left open is a NERDTree
autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTree") && b:NERDTree.isTabTree()) | q | endif

nmap <F2> :NERDTreeToggle<CR>
nmap <F8> :TagbarToggle<CR>
nmap <F9> :GoImports<CR>:GoFmt<CR>:GoBuild<CR>
nmap <F10> :wa<CR>:GoRun<CR>
nmap <F5> :wa \|!rm ./routers/commentsRouter*.go<CR>:!bee run goWebTest<CR>

nnoremap <silent> <C-w>w :ZoomWin<CR>

" set ctrl-hjkl to switch splited windows
map <c-h> <c-w>h
map <c-j> <c-w>j
map <c-k> <c-w>k
map <c-l> <c-w>l

set number
set hlsearch
set tabstop=4
set softtabstop=4
set shiftwidth=4
set expandtab
set backspace=indent,eol,start
set mouse=a

syntax enable
set t_Co=256
set background=dark
colorscheme Tomorrow-Night

" set viminfo location 
set viminfo+=n~/.vim/viminfo

" show last edit position when we reopen file 
au BufReadPost * if line("'\"") > 0|if line("'\"") <= line("$")|exe("norm '\"")|else|exe "norm $"|endif|endif  

" set python3 first
set pyxversion=0

" tagbar with golang settings
" ensure ctags exist.(`pacin ctags` for archlinux)
" go get -u github.com/jstemmer/gotags
let g:tagbar_type_go = {
	\ 'ctagstype' : 'go',
	\ 'kinds'     : [
		\ 'p:package',
		\ 'i:imports:1',
		\ 'c:constants',
		\ 'v:variables',
		\ 't:types',
		\ 'n:interfaces',
		\ 'w:fields',
		\ 'e:embedded',
		\ 'm:methods',
		\ 'r:constructor',
		\ 'f:functions'
	\ ],
	\ 'sro' : '.',
	\ 'kind2scope' : {
		\ 't' : 'ctype',
		\ 'n' : 'ntype'
	\ },
	\ 'scope2kind' : {
		\ 'ctype' : 't',
		\ 'ntype' : 'n'
	\ },
	\ 'ctagsbin'  : 'gotags',
	\ 'ctagsargs' : '-sort -silent'
\ }

" set tags search from current directory to root
set tags=tags;

" set transparent
hi Normal ctermbg=NONE

" set mapleader
let mapleader = " "

" vim-go custom mappings
au filetype go nmap <leader>s <plug>(go-implements)
"au filetype go nmap <leader>i <plug>(go-info)
"au filetype go nmap <leader>gd <plug>(go-doc)
"au filetype go nmap <leader>gv <plug>(go-doc-vertical)
au filetype go nmap <leader>r <plug>(go-run)
au filetype go nmap <leader>b <plug>(go-build)
au filetype go nmap <leader>t <plug>(go-test)
au filetype go nmap <leader>c <plug>(go-coverage)
"au filetype go nmap <leader>ds <plug>(go-def-split)
"au filetype go nmap <leader>dv <plug>(go-def-vertical)
"au filetype go nmap <leader>dt <plug>(go-def-tab)
au filetype go nmap <leader>e <plug>(go-rename)

let g:airline#extensions#tabline#enabled = 1
let g:airline#extensions#whitespace#enabled = 0
let g:airline#extensions#whitespace#symbol = '!'
let g:airline#extensions#tabline#tab_nr_type = 1 " tab number
let g:airline#extensions#tabline#show_tab_nr = 1
let g:airline#extensions#tabline#formatter = 'unique_tail'
let g:airline#extensions#tabline#buffer_nr_show = 0
let g:airline#extensions#tabline#fnametruncate = 16
let g:airline#extensions#tabline#fnamecollapse = 2
let g:airline#extensions#tabline#buffer_idx_mode = 1
nmap <leader>1 <Plug>AirlineSelectTab1
nmap <leader>2 <Plug>AirlineSelectTab2
nmap <leader>3 <Plug>AirlineSelectTab3
nmap <leader>4 <Plug>AirlineSelectTab4
nmap <leader>5 <Plug>AirlineSelectTab5
nmap <leader>6 <Plug>AirlineSelectTab6
nmap <leader>7 <Plug>AirlineSelectTab7
nmap <leader>8 <Plug>AirlineSelectTab8
nmap <leader>9 <Plug>AirlineSelectTab9
nmap <leader>- <Plug>AirlineSelectPrevTab
nmap <leader>+ <Plug>AirlineSelectNextTab
nmap <leader>= <Plug>AirlineSelectNextTab
"
"" javacomplete2 custom config
autocmd FileType java setlocal omnifunc=javacomplete#Complete
"An option to make javacomplete2 use python3 interpreter instead of python2, default value is 0.
let g:JavaComplete_UsePython3 = 1
""To enable smart (trying to guess import option) inserting class imports with F4, add:
autocmd FileType java nmap <F4> <Plug>(JavaComplete-Imports-AddSmart)
autocmd FileType java imap <F4> <Plug>(JavaComplete-Imports-AddSmart)
""To enable usual (will ask for import option) inserting class imports with F5, add:
autocmd FileType java nmap <F5> <Plug>(JavaComplete-Imports-Add)
autocmd FileType java imap <F5> <Plug>(JavaComplete-Imports-Add)
""To add all missing imports with F6:
autocmd FileType java nmap <F6> <Plug>(JavaComplete-Imports-AddMissing)
autocmd FileType java imap <F6> <Plug>(JavaComplete-Imports-AddMissing)
""To remove all unused imports with F7:
autocmd FileType java nmap <F7> <Plug>(JavaComplete-Imports-RemoveUnused)
autocmd FileType java imap <F7> <Plug>(JavaComplete-Imports-RemoveUnused)
